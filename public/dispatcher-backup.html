 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0.50">
  <title>SpecLode</title>
  <link href="https://fonts.googleapis.com/css2?family=Protest+Revolution&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  

  <style>

    body {
      background-color: #111;
      background-image: url('https://www.transparenttextures.com/patterns/brushed-alum.png');
      background-repeat: repeat;
      background-size: auto;
      background-attachment: fixed;
      background-position: center;
      font-family: sans-serif;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .logo {
      width: 850px;
      max-width: 100%;
      display: block;
      margin: 20px auto 10px;
    }
    .title {
      font-family: 'Protest Revolution', cursive;
      font-size: 100px;
      color: #00e6ff;
      text-shadow: 2px 2px 8px #000;
      text-align: center;
      margin: 0;
    }
    .slogan {
      font-family: 'Rancho', cursive;
      font-size: 28px;
      color: #00e6ff;
      text-shadow: 1px 1px 4px #000;
      text-align: center;
      margin-bottom: 30px;
    }
    .section-title {
      text-align: center;
      font-family: 'Protest Revolution', cursive;
      font-size: 2rem;
      color: #00d9ff;
      margin-top: 30px;
    }
    .combo-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 30px;
      margin-bottom: 10px;
    }
    .combo-btn {
      background-color: #003366;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    .combo-btn:hover {
      background-color: #0051a3;
    }
    .combo-btn.active {
      background-color: #28a745;
      color: white;
    }
    .combo-section {
      display: none;
      text-align: center;
      margin-bottom: 30px;
    }
    .combo-section.active {
      display: block;
    }
    label {
      display: inline-block;
      margin: 6px 12px;
    }
    input, button, select {
      padding: 6px;
      font-size: 16px;
      border-radius: 4px;
      margin: 4px;
    }
    button {
      background-color: #00e6ff;
      color: black;
      font-weight: bold;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
    }
    .input-section {
      text-align: center;
      margin-bottom: 30px;
    }
    .row-label {
      text-align: center;
      margin-bottom: 4px;
      color: #00d9ff;
      font-weight: bold;
    }
    .overhang-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }
    .hidden { display: none; }
    .remove-btn {
      background-color: #ff4444;
      color: white;
      border: none;
      padding: 4px 10px;
      margin-left: 10px;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    .vehicle-entry-row {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 16px;        /* spacing between fields and button */
  flex-wrap: wrap;  /* responsive for mobile */
  margin: 0 auto;
  width: 100%;
  max-width: 900px; /* or whatever max width you want */
}
.vehicle-entry-row label,
.vehicle-entry-row button {
  margin-bottom: 0;
}
.upgrade-btn-row {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 32px;
  margin-bottom: 32px;
}

.upgrade-btn {
  background: #ffcb05;
  color: #222;
  font-family: 'Protest Revolution', cursive;
  font-size: 1.15rem;
  font-weight: bold;
  padding: 11px 0;
  border: none;
  border-radius: 9px;
  box-shadow: 0 2px 9px rgba(0,0,0,0.16);
  cursor: pointer;
  width: 220px;         /* Match exactly the width of Reset Power Unit 2 */
  max-width: 220px;     /* Prevents expansion on large screens */
  min-width: 220px;     /* Ensures no shrinking */
  text-align: center;
  transition: background 0.2s, color 0.2s;
  display: block;
}
.upgrade-btn:hover {
  background: #ffd740;
  color: #111;
}



  </style>
</head>
<body>
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dispatcher</title>
  <style>
    body {
      zoom: 0.75;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .avatar-container {
      position: absolute;
      top: 10px;
      right: 10px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
    }

    .dropdown {
      position: absolute;
      top: 50px;
      right: 0;
      background-color: #fff;
      border: 1px solid #ccc;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      display: none;
      border-radius: 8px;
      z-index: 999;
    }

    .dropdown a {
      display: block;
      padding: 10px 20px;
      text-decoration: none;
      color: #333;
    }

    .dropdown a:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  
  <div class="avatar-container">
    <img
      src="https://www.w3schools.com/howto/img_avatar.png"
      alt="Avatar"
      class="avatar"
      id="avatarBtn"
    />
    <div class="dropdown" id="avatarDropdown">
      <a href="#">My Account</a>
      <a href="#">Subscription</a>
      <a href="#">Logout</a>
    </div>
  </div>

  <script>
    const avatarBtn = document.getElementById("avatarBtn");
    const avatarDropdown = document.getElementById("avatarDropdown");

    avatarBtn.addEventListener("click", () => {
      avatarDropdown.style.display =
        avatarDropdown.style.display === "block" ? "none" : "block";
    });

    window.addEventListener("click", (e) => {
      if (!avatarBtn.contains(e.target) && !avatarDropdown.contains(e.target)) {
        avatarDropdown.style.display = "none";
      }
    });
  </script>
</body>
</html>

<img src="./images/speclode-car-logo.png" alt="SpecLode Car Logo" class="logo">
<div class="title">SpecLode</div>
<div class="slogan">Load Smart. Drive Legal. Powered by SPECLODE!</div>

<h2 class="section-title">Register Power Unit Combinations (Max 3)</h2>

<div class="combo-buttons" id="comboButtonsContainer"></div>

<div id="comboMessage" style="text-align:center; margin-bottom: 20px;"></div>

<div id="combo1" class="combo-section">
  <label>Power Unit Weight: <input type="number" id="powerUnitWeight1"></label>
  <label>Trailer Weight: <input type="number" id="trailerWeight1"></label><br>
  <label>Power Unit GVWR: <input type="number" id="powerUnitGVWR1"></label>
  <label>Trailer GVWR: <input type="number" id="trailerGVWR1"></label>
</div>

<div id="combo2" class="combo-section">
  <label>Power Unit Weight: <input type="number" id="powerUnitWeight2"></label>
  <label>Trailer Weight: <input type="number" id="trailerWeight2"></label><br>
  <label>Power Unit GVWR: <input type="number" id="powerUnitGVWR2"></label>
  <label>Trailer GVWR: <input type="number" id="trailerGVWR2"></label>
</div>

<div id="combo3" class="combo-section">
  <label>Power Unit Weight: <input type="number" id="powerUnitWeight3"></label>
  <label>Trailer Weight: <input type="number" id="trailerWeight3"></label><br>
  <label>Power Unit GVWR: <input type="number" id="powerUnitGVWR3"></label>
  <label>Trailer GVWR: <input type="number" id="trailerGVWR3"></label>
</div>

<div id="combo4" class="combo-section">
  <label>Power Unit Weight: <input type="number" id="powerUnitWeight4"></label>
  <label>Trailer Weight: <input type="number" id="trailerWeight4"></label><br>
  <label>Power Unit GVWR: <input type="number" id="powerUnitGVWR4"></label>
  <label>Trailer GVWR: <input type="number" id="trailerGVWR4"></label>
</div>

<div id="combo5" class="combo-section">
  <label>Power Unit Weight: <input type="number" id="powerUnitWeight5"></label>
  <label>Trailer Weight: <input type="number" id="trailerWeight5"></label><br>
  <label>Power Unit GVWR: <input type="number" id="powerUnitGVWR5"></label>
  <label>Trailer GVWR: <input type="number" id="trailerGVWR5"></label>
</div>

<div class="input-section">
  <p>Combined GVWR: <span id="combinedGVWR">0</span> lbs</p>
  <p>Max Load Weight: <span id="maxLoad">0</span> lbs</p>
</div>
<h2 class="section-title">Trailer Setup</h2>
<div class="input-section">
  <label for="trailerType">Trailer Type:</label>
  <select id="trailerType">
    <option value="single">Single Deck</option>
    <option value="double">Double Deck</option>
  </select>
</div>

<div class="row-label" id="labelRowSingle">Deck Measurements</div>
<div class="input-section overhang-row" id="overhangRowSingle">
  <label>Front Overhang (ft): <input type="number" id="frontOverhang" /></label>
  <label>Deck Length (ft): <input type="number" id="trailerLength" /></label>
  <label>Rear Overhang (ft): <input type="number" id="rearOverhang" /></label>
</div>

<div class="row-label hidden" id="labelRowDoubleTop">Top Deck Measurements</div>
<div class="input-section overhang-row hidden" id="overhangRowDouble">
  <label>Front Overhang (ft): <input type="number" id="frontOverhang2" /></label>
  <label>Deck Length (ft): <input type="number" id="trailerLength2" /></label>
  <label>Rear Overhang (ft): <input type="number" id="rearOverhang2" /></label>
</div>

<div class="row-label hidden" id="labelRowDoubleBottom">Bottom Deck Measurements</div>
<div class="input-section overhang-row hidden" id="overhangRowDouble2">
  <label>Front Overhang (ft): <input type="number" id="bottomFrontOverhang" /></label>
  <label>Deck Length (ft): <input type="number" id="bottomDeckLength" /></label>
  <label>Rear Overhang (ft): <input type="number" id="bottomRearOverhang" /></label>
</div>

<div id="singleDeckHeights" class="input-section">
  <h3 class="section-title">Single Deck Heights</h3>
  <label>Front Height (in): <input type="number" id="front-clearance" /></label>
  <label>Center Height (in): <input type="number" id="center-clearance" /></label>
  <label>Rear Height (in): <input type="number" id="rear-clearance" /></label>
</div>

<div id="doubleDeckHeights" class="input-section hidden">
  <h3 class="section-title">Double Deck Heights</h3>
  <label>Upper Front (in): <input type="number" id="upper-front-clearance" /></label>
  <label>Upper Center (in): <input type="number" id="upper-center-clearance" /></label>
  <label>Upper Rear (in): <input type="number" id="upper-rear-clearance" /></label>
  <br>
  <label>Lower Front Clearance (in): <input type="number" id="lower-front-clearance" /></label>
  <label>Lower Center Clearance (in): <input type="number" id="lower-center-clearance" /></label>
  <label>Lower Rear Clearance (in): <input type="number" id="lower-rear-clearance" /></label>
</div>

<div class="input-section">
  <button id="saveButton1" onclick="saveCombo(1)">Save Combo 1</button>
  <button id="saveButton2" onclick="saveCombo(2)">Save Combo 2</button>
  <button id="saveButton3" onclick="saveCombo(3)">Save Combo 3</button>
  <button id="saveButton4" onclick="saveCombo(3)">Save Combo 4</button>
  <button id="saveButton5" onclick="saveCombo(3)">Save Combo 5</button>
</div>

<h2 class="section-title">Vehicle Entry</h2>
<form class="input-section" id="vehicleEntryForm" autocomplete="off">
  <div class="vehicle-entry-row">
    <label style="font-size: 12px; color: #ccc;">Year: <input type="text" id="vehicleYear" placeholder="Year" required /></label>
    <label style="font-size: 12px; color: #ccc;">Make: <input type="text" id="vehicleMake" placeholder="Make" required /></label>
    <label style="font-size: 12px; color: #ccc;">Model: <input type="text" id="vehicleModel" placeholder="Model" required /></label>
    <label style="font-size: 12px; color: #ccc;">Trim: <input type="text" id="vehicleTrim" placeholder="Trim" required /></label>
    <button type="submit" id="getVehicleData">Get Vehicle Data</button>
  </div>
</form>

<div class="input-section" style="text-align: center;">
  <h3 class="section-title">Loaded Vehicles</h3>
  <ul id="loadedVehicleList" style="list-style: none; padding: 0; color: #00e6ff;"></ul>
</div>

<div id="admintools" style="display: block; text-align: center;">
  <button id="clearAllLoaded">Clear All Loaded Vehicles (Active Combo)</button>
  <h3 style="color: red;">Admin Tools</h3>
  <button id="resetCombo1">Reset Power Unit 1</button>
  <button id="resetCombo2">Reset Power Unit 2</button>
  <button id="resetCombo3">Reset Power Unit 3</button>
</div>

<div class="upgrade-btn-row">
  <button class="upgrade-btn" id="upgradeSubscriptionBtn">Upgrade Subscription</button>
</div>


<script>

  // ✅ Redirect to login if no token is found
const token = localStorage.getItem("token");
if (!token) {
  window.location.href = "login.html";
}

// Call once on page load:

const isAdmin = localStorage.getItem("userRole") === "admin";
function normalize(str) {
  return str.trim().toLowerCase().replace(/\s+/g, "_");
}
function isAllCombosSaved() {
  return [1, 2, 3, 4, 5].every(i => localStorage.getItem("combo" + i));
}
function checkAllCombos() {
  if (isAllCombosSaved()) {
    document.getElementById("comboMessage").textContent =
      "All combos saved. Select a power unit to begin loading trailer using its limits.";
  }
}
function clearLoadedVehicles() {
  const activeCombo = localStorage.getItem("activeCombo");
  if (!confirm("⚠️ Clear all loaded vehicles? This will restore load/length capacity.")) return;
  const list = document.getElementById("loadedVehicleList");
  if (list) list.innerHTML = "";
  localStorage.removeItem(`combo${activeCombo}_loadedVehicles`);
  localStorage.removeItem(`combo${activeCombo}_usedLength`);
  localStorage.removeItem(`combo${activeCombo}_usedLength_lower`);
  localStorage.removeItem(`combo${activeCombo}_usedLength_upper`);
  localStorage.removeItem(`combo${activeCombo}_usedWeight`);
  // Restore max load/length
  const puGVWR = parseFloat(localStorage.getItem("powerUnitGVWR" + activeCombo)) || 0;
  const trGVWR = parseFloat(localStorage.getItem("trailerGVWR" + activeCombo)) || 0;
  const puWeight = parseFloat(localStorage.getItem("powerUnitWeight" + activeCombo)) || 0;
  const trWeight = parseFloat(localStorage.getItem("trailerWeight" + activeCombo)) || 0;
  const fullMaxLoad = (puGVWR + trGVWR) - (puWeight + trWeight);
  const trailerType = localStorage.getItem(`combo${activeCombo}_trailerType`) || "single";
  const frontOverhang = parseFloat(localStorage.getItem(`combo${activeCombo}_${trailerType === "double" ? "bottomFrontOverhang" : "frontOverhang"}`)) || 0;
  const trailerLength = parseFloat(localStorage.getItem(`combo${activeCombo}_${trailerType === "double" ? "bottomDeckLength" : "trailerLength"}`)) || 0;
  const rearOverhang = parseFloat(localStorage.getItem(`combo${activeCombo}_${trailerType === "double" ? "bottomRearOverhang" : "rearOverhang"}`)) || 0;
  localStorage.setItem(`combo${activeCombo}_remainingLoad`, fullMaxLoad);
  localStorage.setItem(`combo${activeCombo}_remainingLength`, (frontOverhang + trailerLength + rearOverhang) * 12);
  if (document.getElementById("maxLoad")) {
    document.getElementById("maxLoad").textContent = fullMaxLoad.toLocaleString();
  }
}
function resetCombo(id) {
  localStorage.removeItem(`combo${id}_usedLength`);
  localStorage.removeItem(`combo${id}_usedWeight`);
  localStorage.removeItem(`combo${id}_usedLength_upper`);
  localStorage.removeItem(`combo${id}_usedLength_lower`);
  localStorage.removeItem(`combo${id}_loadedVehicles`);
  if (!confirm(`⚠️ Are you sure you want to reset Power Unit ${id}? This cannot be undone.`)) return;
  localStorage.removeItem("combo" + id);
  ["powerUnitWeight", "trailerWeight", "powerUnitGVWR", "trailerGVWR"].forEach(field => {
    localStorage.removeItem(field + id);
    const input = document.getElementById(field + id);
    if (input) {
      input.value = "";
      input.disabled = false;
    }
  });
  [
    "frontOverhang", "trailerLength", "rearOverhang",
    "frontOverhang2", "trailerLength2", "rearOverhang2",
    "bottomFrontOverhang", "bottomDeckLength", "bottomRearOverhang",
    "front-clearance", "center-clearance", "rear-clearance",
    "upper-front-clearance", "upper-center-clearance", "upper-rear-clearance",
    "lower-front-clearance", "lower-center-clearance", "lower-rear-clearance",
    "trailerType"
  ].forEach(field => {
    const key = `combo${id}_` + field;
    localStorage.removeItem(key);
    const input = document.getElementById(field);
    if (input) {
      input.disabled = false;
      if (field === "trailerType") {
        input.value = "single";
        const event = new Event("change");
        input.dispatchEvent(event);
      } else {
        input.value = "";
      }
    }
  });
  // Show Save button for this combo
  const saveBtn = document.getElementById("saveButton" + id);
  if (saveBtn) {
    saveBtn.disabled = false;
    saveBtn.style.display = "inline-block";
  }
  if (document.getElementById("combinedGVWR")) document.getElementById("combinedGVWR").textContent = "0";
  if (document.getElementById("maxLoad")) document.getElementById("maxLoad").textContent = "0";
}
function saveCombo(id) {
  if (!confirm("Are you sure you want to save this combination? You will not be able to change any information once saved.")) return;
  const prefix = `combo${id}`;
  const comboData = {};
  ["powerUnitWeight", "trailerWeight", "powerUnitGVWR", "trailerGVWR"].forEach(field => {
    const input = document.getElementById(field + id);
    if (input) {
      comboData[field] = input.value;
      localStorage.setItem(field + id, input.value);
      input.disabled = true;
    }
  });
  const trailerFields = [
    "frontOverhang", "trailerLength", "rearOverhang",
    "frontOverhang2", "trailerLength2", "rearOverhang2",
    "bottomFrontOverhang", "bottomDeckLength", "bottomRearOverhang",
    "front-clearance", "center-clearance", "rear-clearance",
    "upper-front-clearance", "upper-center-clearance", "upper-rear-clearance",
    "lower-front-clearance", "lower-center-clearance", "lower-rear-clearance",
    "trailerType"
  ];
  trailerFields.forEach(field => {
    const input = document.getElementById(field);
    if (input) {
      localStorage.setItem(`${prefix}_` + field, input.value);
      input.disabled = true;
    }
  });
  localStorage.setItem(prefix, JSON.stringify(comboData));
  localStorage.setItem("activeCombo", id);
  const trailerType = document.getElementById("trailerType");
  if (trailerType) trailerType.disabled = true;
  const saveBtn = document.getElementById(`saveButton${id}`);
  if (saveBtn) {
    saveBtn.disabled = true;
    saveBtn.style.display = 'none';
  }
  const puGVWR = parseFloat(localStorage.getItem("powerUnitGVWR" + id)) || 0;
  const trGVWR = parseFloat(localStorage.getItem("trailerGVWR" + id)) || 0;
  const puWeight = parseFloat(localStorage.getItem("powerUnitWeight" + id)) || 0;
  const trWeight = parseFloat(localStorage.getItem("trailerWeight" + id)) || 0;
  const combinedGVWR = puGVWR + trGVWR;
  const totalWeight = puWeight + trWeight;
  const maxLoad = combinedGVWR - totalWeight;
  document.getElementById("combinedGVWR").textContent = combinedGVWR.toLocaleString();
  document.getElementById("maxLoad").textContent = maxLoad.toLocaleString();
  checkAllCombos();
}
let lastActiveCombo = null;
function showCombo(index) {
  const trailerType = document.getElementById("trailerType");
  const isSaved = localStorage.getItem("combo" + index);
  localStorage.setItem("activeCombo", index);
  document.querySelectorAll('.combo-section').forEach(el => el.classList.remove("active"));
  const current = document.getElementById("combo" + index);
  if (current) current.classList.add("active");
  const comboButtons = document.querySelectorAll('.combo-buttons .combo-btn');
  comboButtons.forEach((btn, btnIdx) => {
    if (btnIdx + 1 === index) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
  if (trailerType) {
    trailerType.disabled = !!isSaved;
  }
  const saveBtn = document.getElementById("saveButton" + index);
  if (saveBtn) {
    saveBtn.style.display = isSaved ? "none" : "inline-block";
    saveBtn.disabled = !!isSaved;
  }
  ["powerUnitWeight", "trailerWeight", "powerUnitGVWR", "trailerGVWR"].forEach(field => {
    const input = document.getElementById(field + index);
    const storedVal = localStorage.getItem(field + index);
    if (input && storedVal !== null) {
      input.value = storedVal;
      input.disabled = !!isSaved;
    } else if (input) {
      input.value = "";
      input.disabled = false;
    }
  });
  const list = document.getElementById("loadedVehicleList");
  list.innerHTML = "";
  const savedList = JSON.parse(localStorage.getItem(`combo${index}_loadedVehicles`) || "[]");
  savedList.forEach(vehicleObj => {
    const { label } = typeof vehicleObj === 'object' ? vehicleObj : { label: vehicleObj };
    const li = document.createElement("li");
    li.className = "loaded-vehicle-entry";
    const text = document.createTextNode(label + " ");
    const removeBtn = document.createElement("button");
    removeBtn.textContent = "Remove";
    removeBtn.className = "remove-btn";
    removeBtn.style.marginLeft = "10px";
    removeBtn.onclick = () => {
      li.remove();
      // Optionally update storage...
    };
    li.appendChild(text);
    li.appendChild(removeBtn);
    list.appendChild(li);
  });
  lastActiveCombo = index;
  const trailerFields = [
    "frontOverhang", "trailerLength", "rearOverhang",
    "frontOverhang2", "trailerLength2", "rearOverhang2",
    "bottomFrontOverhang", "bottomDeckLength", "bottomRearOverhang",
    "front-clearance", "center-clearance", "rear-clearance",
    "upper-front-clearance", "upper-center-clearance", "upper-rear-clearance",
    "lower-front-clearance", "lower-center-clearance", "lower-rear-clearance",
    "trailerType"
  ];
  trailerFields.forEach(field => {
    const input = document.getElementById(field);
    const storedVal = localStorage.getItem(`combo${index}_` + field);
    if (input && storedVal !== null) {
      input.value = storedVal;
      input.disabled = !!isSaved;
    } else if (input) {
      input.value = "";
      input.disabled = false;
    }
  });
  const puGVWR = parseFloat(localStorage.getItem("powerUnitGVWR" + index)) || 0;
  const trGVWR = parseFloat(localStorage.getItem("trailerGVWR" + index)) || 0;
  const puWeight = parseFloat(localStorage.getItem("powerUnitWeight" + index)) || 0;
  const trWeight = parseFloat(localStorage.getItem("trailerWeight" + index)) || 0;
  const combinedGVWR = puGVWR + trGVWR;
  const totalWeight = puWeight + trWeight;
  const maxLoad = combinedGVWR - totalWeight;
  document.getElementById("combinedGVWR").textContent = combinedGVWR.toLocaleString();
  document.getElementById("maxLoad").textContent = maxLoad.toLocaleString();
  ["powerUnitWeight", "trailerWeight", "powerUnitGVWR", "trailerGVWR"].forEach(field => {
    const input = document.getElementById(field + index);
    if (input) {
      input.dispatchEvent(new Event("input"));
    }
  });
  setupTrailerToggle();
}
function toggleDeckSelectorVisibility() {
  const trailerType = document.getElementById("trailerType")?.value || "single";
}
function setupTrailerToggle() {
  const trailerType = document.getElementById("trailerType");
  if (!trailerType) return;
  trailerType.addEventListener("change", function () {
    const isDouble = this.value === "double";
    document.getElementById("singleDeckHeights").classList.toggle("hidden", isDouble);
    document.getElementById("doubleDeckHeights").classList.toggle("hidden", !isDouble);
    document.getElementById("labelRowSingle").classList.toggle("hidden", isDouble);
    document.getElementById("overhangRowSingle").classList.toggle("hidden", isDouble);
    document.getElementById("labelRowDoubleTop").classList.toggle("hidden", !isDouble);
    document.getElementById("overhangRowDouble").classList.toggle("hidden", !isDouble);
    document.getElementById("labelRowDoubleBottom").classList.toggle("hidden", !isDouble);
    document.getElementById("overhangRowDouble2").classList.toggle("hidden", !isDouble);
    toggleDeckSelectorVisibility();
  });
  const isDouble = trailerType.value === "double";
  document.getElementById("singleDeckHeights").classList.toggle("hidden", isDouble);
  document.getElementById("doubleDeckHeights").classList.toggle("hidden", !isDouble);
  document.getElementById("labelRowSingle").classList.toggle("hidden", isDouble);
  document.getElementById("overhangRowSingle").classList.toggle("hidden", isDouble);
  document.getElementById("labelRowDoubleTop").classList.toggle("hidden", !isDouble);
  document.getElementById("overhangRowDouble").classList.toggle("hidden", !isDouble);
  document.getElementById("labelRowDoubleBottom").classList.toggle("hidden", !isDouble);
  document.getElementById("overhangRowDouble2").classList.toggle("hidden", !isDouble);
  toggleDeckSelectorVisibility();
}
setupTrailerToggle();
// Save trailer fields per combo on input
[
  "frontOverhang", "trailerLength", "rearOverhang",
  "frontOverhang2", "trailerLength2", "rearOverhang2",
  "bottomFrontOverhang", "bottomDeckLength", "bottomRearOverhang",
  "front-clearance", "center-clearance", "rear-clearance",
  "upper-front-clearance", "upper-center-clearance", "upper-rear-clearance",
  "lower-front-clearance", "lower-center-clearance", "lower-rear-clearance",
  "trailerType"
].forEach(field => {
  const input = document.getElementById(field);
  if (input) {
    input.addEventListener("input", () => {
      const active = localStorage.getItem("activeCombo");
      if (active) {
        localStorage.setItem(`combo${active}_` + field, input.value);
        if (field === "trailerType") {
          const locked = localStorage.getItem("combo" + active);
          if (!locked) {
            const event = new Event("change");
            input.dispatchEvent(event);
          }
        }
      }
    });
  }
});
[1, 2, 3].forEach(i => {
  ['powerUnitWeight', 'trailerWeight', 'powerUnitGVWR', 'trailerGVWR'].forEach(baseId => {
    const input = document.getElementById(baseId + i);
    if (input) {
      input.addEventListener('input', () => {
        const puGVWR = parseFloat(document.getElementById("powerUnitGVWR" + i)?.value) || 0;
        const trGVWR = parseFloat(document.getElementById("trailerGVWR" + i)?.value) || 0;
        const puWeight = parseFloat(document.getElementById("powerUnitWeight" + i)?.value) || 0;
        const trWeight = parseFloat(document.getElementById("trailerWeight" + i)?.value) || 0;
        const combinedGVWR = puGVWR + trGVWR;
        const totalWeight = puWeight + trWeight;
        const maxLoad = combinedGVWR - totalWeight;
        document.getElementById("combinedGVWR").textContent = combinedGVWR.toLocaleString();
        document.getElementById("maxLoad").textContent = maxLoad.toLocaleString();
      });
    }
  });
});
document.getElementById("clearAllLoaded")?.addEventListener("click", clearLoadedVehicles);
document.getElementById("resetCombo1")?.addEventListener("click", () => resetCombo(1));
document.getElementById("resetCombo2")?.addEventListener("click", () => resetCombo(2));
document.getElementById("resetCombo3")?.addEventListener("click", () => resetCombo(3));

// ============ MODALS & VEHICLE DATA MODULE =============
// --- Modal helpers as in your latest file ---

function showDeckChoiceModalDouble(vehicleSpecs, lowerSpecs, upperSpecs, onSelect) {
  const overlay = document.createElement("div");
  Object.assign(overlay.style, {
    position: "fixed",
    top: 0, left: 0, right: 0, bottom: 0,
    backgroundColor: "rgba(0,0,0,0.5)",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    zIndex: 9999
  });
  const box = document.createElement("div");
  Object.assign(box.style, {
  backgroundColor: "#222",
  color: "#fff",
  padding: "38px 32px",     // slightly more vertical/horizontal padding
  borderRadius: "16px",
  textAlign: "left",
  minWidth: "340px",        // keeps it large enough on desktop
  maxWidth: "480px",        // max width for a box shape (desktop)
  width: "94vw",            // responsive on mobile
  fontSize: "1.18rem",
  margin: "0 auto",         // center in parent (fallback, but flex handles most)
  boxShadow: "0 6px 32px 0 rgba(0,0,0,0.6)",
  display: "block"          // ensure block (just in case)
});


  function getReasons(deckSpecs, vehicleSpecs, isLowerDeck) {
    let reasons = [];
    if (isLowerDeck) {
      if ((vehicleSpecs.height + deckSpecs.clearance) > 168) reasons.push("Too tall (vehicle + lower deck clearance exceeds 14 ft)");
      if (vehicleSpecs.height > deckSpecs.clearance) reasons.push("Vehicle height exceeds lower deck clearance");
      if (vehicleSpecs.length > deckSpecs.remainingLength) reasons.push("Too long for lower deck");
      if (vehicleSpecs.weight > deckSpecs.maxLoad) reasons.push("Too heavy for lower deck");
    } else {
      if ((vehicleSpecs.height + deckSpecs.height) > 168) reasons.push("Too tall (vehicle + upper deck height exceeds 14 ft)");
      if (vehicleSpecs.length > deckSpecs.remainingLength) reasons.push("Too long for upper deck");
      if (vehicleSpecs.weight > deckSpecs.maxLoad) reasons.push("Too heavy for upper deck");
    }
    return reasons;
  }
  const lowerReasons = getReasons(lowerSpecs, vehicleSpecs, true);
  const upperReasons = getReasons(upperSpecs, vehicleSpecs, false);
  let msg = `
    <div style="font-weight:bold;font-size:1.16rem;margin-bottom:6px;">Vehicle Specs:</div>
    <div style="margin-bottom:7px;">
      • Weight: ${vehicleSpecs.weight} lbs<br>
      • Height: ${vehicleSpecs.height} in<br>
      • Length: ${vehicleSpecs.length} in
    </div>
    <div style="font-weight:bold;font-size:1.13rem;margin-bottom:3px;">Trailer Limits:</div>
    <div style="margin-bottom:5px;">
      • Max Load: ${lowerSpecs.maxLoad} lbs<br>
    </div>
    <div style="display:flex;justify-content:space-between;gap:16px;">
      <div style="flex:1;background:#333;border-radius:8px;padding:10px 14px 8px 14px;">
        <b>Lower Deck</b>
        <div>Clearance: ${lowerSpecs.clearance} in</div>
        <div>Length Left: ${lowerSpecs.remainingLength.toFixed(1)} in</div>
        <div>
          ${lowerSpecs.fits 
            ? "<span style='color:#0e0;'>✅ Fits</span>"
            : "<span style='color:#e33;font-weight:bold;'>❌ No Fit</span>"
          }
        </div>
        ${!lowerSpecs.fits && lowerReasons.length > 0 ? "<ul style='color:#e66;padding-left:1.3em;margin-top:0.3em;'>" + lowerReasons.map(r => `<li>${r}</li>`).join('') + "</ul>" : ""}
      </div>
      <div style="flex:1;background:#333;border-radius:8px;padding:10px 14px 8px 14px;">
        <b>Upper Deck</b>
        <div>Deck Height: ${upperSpecs.height} in</div>
        <div>Length Left: ${upperSpecs.remainingLength.toFixed(1)} in</div>
        <div>
          ${upperSpecs.fits 
            ? "<span style='color:#0e0;'>✅ Fits</span>"
            : "<span style='color:#e33;font-weight:bold;'>❌ No Fit</span>"
          }
        </div>
        ${!upperSpecs.fits && upperReasons.length > 0 ? "<ul style='color:#e66;padding-left:1.3em;margin-top:0.3em;'>" + upperReasons.map(r => `<li>${r}</li>`).join('') + "</ul>" : ""}
      </div>
    </div>
    <div style="margin-top:17px;margin-bottom:6px;">
      Remaining Capacity After Load: <b>${lowerSpecs.weightLeft.toLocaleString()} lbs</b>
    </div>
    <div style="display:flex;justify-content:center;gap:16px;margin-top:13px;">`;
  if (upperSpecs.fits) msg += `<button id="btn-upper" style="padding:9px 20px;background:#06e;color:#000;font-weight:600;border:none;border-radius:7px;cursor:pointer;">Load Upper Deck</button>`;
  if (lowerSpecs.fits) msg += `<button id="btn-lower" style="padding:9px 20px;background:#0ee;color:#000;font-weight:600;border:none;border-radius:7px;cursor:pointer;">Load Lower Deck</button>`;
  msg += `<button id="btn-double-cancel" style="padding:9px 18px;background:#444;color:#fff;font-weight:500;border:none;border-radius:7px;cursor:pointer;margin-left:10px;">Cancel</button>`;
  msg += `</div>`;
  box.innerHTML = msg;
  overlay.appendChild(box);
  document.body.appendChild(overlay);
  if (upperSpecs.fits) box.querySelector("#btn-upper").onclick = () => {
    onSelect("upper");
    document.body.removeChild(overlay);
  };
  if (lowerSpecs.fits) box.querySelector("#btn-lower").onclick = () => {
    onSelect("lower");
    document.body.removeChild(overlay);
  };
  box.querySelector("#btn-double-cancel").onclick = () => {
    document.body.removeChild(overlay);
  };
}
function showSingleDeckModal(vehicleSpecs, deckSpecs, fits, reasons, weightLeft, onLoad) {
  const overlay = document.createElement("div");
  Object.assign(overlay.style, {
    position: "fixed",
    top: 0, left: 0, right: 0, bottom: 0,
    backgroundColor: "rgba(0,0,0,0.5)",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    zIndex: 9999
  });
  const box = document.createElement("div");
  Object.assign(box.style, {
  backgroundColor: "#222",
  color: "#fff",
  padding: "38px 32px",     // slightly more vertical/horizontal padding
  borderRadius: "16px",
  textAlign: "left",
  minWidth: "340px",        // keeps it large enough on desktop
  maxWidth: "480px",        // max width for a box shape (desktop)
  width: "94vw",            // responsive on mobile
  fontSize: "1.18rem",
  margin: "0 auto",         // center in parent (fallback, but flex handles most)
  boxShadow: "0 6px 32px 0 rgba(0,0,0,0.6)",
  display: "block"          // ensure block (just in case)
});


  let msg = `
    <div style="font-weight:bold;font-size:1.16rem;margin-bottom:6px;">Vehicle Specs:</div>
    <div style="margin-bottom:7px;">
      • Weight: ${vehicleSpecs.weight} lbs<br>
      • Height: ${vehicleSpecs.height} in<br>
      • Length: ${vehicleSpecs.length} in
    </div>
    <div style="font-weight:bold;font-size:1.13rem;margin-bottom:3px;">Trailer Limits:</div>
    <div style="margin-bottom:5px;">
      • Max Load: ${deckSpecs.maxLoad} lbs<br>
      • Deck Height: ${deckSpecs.deckHeight} in<br>
      • Deck Length Left: ${deckSpecs.remainingLength.toFixed(1)} in
    </div>
  `;
  if (fits) {
    msg += `<div style="color:#0e0;font-weight:bold;margin-bottom:8px;">✅ Vehicle fits within current combo limits!</div>`;
    msg += `<div style="margin-bottom:9px;">Remaining Capacity After Load: <b>${weightLeft.toLocaleString()} lbs</b></div>`;
  } else {
    msg += `<div style="color:#e33;font-weight:bold;margin-bottom:8px;">❌ Vehicle does NOT fit:</div>`;
    msg += `<ul style="color:#e66;margin-bottom:9px;">`;
    reasons.forEach(r => { msg += `<li>${r}</li>`; });
    msg += `</ul>`;
  }
  msg += `<div style="display:flex;justify-content:center;gap:16px;margin-top:13px;">`;
  if (fits) {
    msg += `<button id="btn-single-load" style="padding:9px 24px;background:#0ee;color:#000;font-weight:600;border:none;border-radius:7px;cursor:pointer;">Load Vehicle</button>`;
  }
  msg += `<button id="btn-single-cancel" style="padding:9px 18px;background:#444;color:#fff;font-weight:500;border:none;border-radius:7px;cursor:pointer;margin-left:10px;">Cancel</button>`;
  msg += `</div>`;
  box.innerHTML = msg;
  overlay.appendChild(box);
  document.body.appendChild(overlay);
  if (fits) {
    box.querySelector("#btn-single-load").onclick = () => {
      document.body.removeChild(overlay);
      onLoad();
    };
  }
  box.querySelector("#btn-single-cancel").onclick = () => {
    document.body.removeChild(overlay);
  };
}
// === VEHICLE DATA BUTTON LOGIC ===
//document.getElementById("getVehicleData")?.addEventListener("click", function () {
document.getElementById("vehicleEntryForm")?.addEventListener("submit", function(e) {
  e.preventDefault();  // <- This is essential!
  // Move your Get Vehicle Data logic here.
  // (Just copy everything from your old click handler)

  const activeCombo = localStorage.getItem("activeCombo");
  const comboPrefix = `combo${activeCombo}_`;
  const trailerType = localStorage.getItem(comboPrefix + "trailerType") || "single";
  let selectedDeck = (trailerType === "double") ? "" : "single";
  const yearInput = document.getElementById("vehicleYear");
  const makeInput = document.getElementById("vehicleMake");
  const modelInput = document.getElementById("vehicleModel");
  const trimInput = document.getElementById("vehicleTrim");
  if (!yearInput || !makeInput || !modelInput || !trimInput) {
    alert("❌ One or more fields not found");
    return;
  }
  const year = yearInput.value.trim();
  const make = normalize(makeInput.value);
  const model = normalize(modelInput.value);
  const trim = normalize(trimInput.value);
  const key = `${year}_${make}_${model}_${trim}`;
  const mockDatabase = {
    "2023_ford_f150_xlt": { weight: 4500, height: 77.2, length: 231.7 },
    "2020_toyota_camry_le": { weight: 3340, height: 56.9, length: 192.1 },
    "2022_honda_civic_ex": { weight: 2900, height: 55.7, length: 184.0 }
  };
  const specs = mockDatabase[key];
  if (!specs) {
    alert("❌ Not found in mock database");
    return;
  }
  const puGVWR = parseFloat(localStorage.getItem("powerUnitGVWR" + activeCombo)) || 0;
  const trGVWR = parseFloat(localStorage.getItem("trailerGVWR" + activeCombo)) || 0;
  const puWeight = parseFloat(localStorage.getItem("powerUnitWeight" + activeCombo)) || 0;
  const trWeight = parseFloat(localStorage.getItem("trailerWeight" + activeCombo)) || 0;
  const combinedGVWR = puGVWR + trGVWR;
  const storedLoad = parseFloat(localStorage.getItem(`combo${activeCombo}_remainingLoad`));
  const currentMaxLoad = isNaN(storedLoad) ? (combinedGVWR - (puWeight + trWeight)) : storedLoad;
  if (trailerType === "double") {
    function getComboValue(comboPrefix, fieldId) {
      let val = localStorage.getItem(comboPrefix + fieldId);
      if (val === null || val === undefined || val === "") {
        const input = document.getElementById(fieldId);
        if (input && input.value !== "") {
          val = input.value;
        }
      }
      return parseFloat(val) || 0;
    }
    const lowerFrontOverhang   = getComboValue(comboPrefix, "bottomFrontOverhang");
    const lowerDeckLength      = getComboValue(comboPrefix, "bottomDeckLength");
    const lowerRearOverhang    = getComboValue(comboPrefix, "bottomRearOverhang");
    const lowerFrontClearance  = getComboValue(comboPrefix, "lower-front-clearance");
    const lowerDeckTotalLength = (lowerFrontOverhang + lowerDeckLength + lowerRearOverhang) * 12;
    const lowerUsedLength      = parseFloat(localStorage.getItem(`combo${activeCombo}_usedLength_lower`)) || 0;
    const lowerRemainingLength = lowerDeckTotalLength - lowerUsedLength;
    const upperFrontOverhang   = getComboValue(comboPrefix, "frontOverhang2");
    const upperDeckLength      = getComboValue(comboPrefix, "trailerLength2");
    const upperRearOverhang    = getComboValue(comboPrefix, "rearOverhang2");
    const upperDeckHeight      = getComboValue(comboPrefix, "upper-front-clearance");
    const upperDeckTotalLength = (upperFrontOverhang + upperDeckLength + upperRearOverhang) * 12;
    const upperUsedLength      = parseFloat(localStorage.getItem(`combo${activeCombo}_usedLength_upper`)) || 0;
    const upperRemainingLength = upperDeckTotalLength - upperUsedLength;
    const lowerFits =
      specs.height <= lowerFrontClearance &&
      specs.length <= lowerRemainingLength &&
      specs.weight <= currentMaxLoad &&
      (specs.height + lowerFrontClearance <= 168);
    const upperFits =
      (specs.height + upperDeckHeight <= 168) &&
      specs.length <= upperRemainingLength &&
      specs.weight <= currentMaxLoad;
    if (!lowerFits && !upperFits) {
      showDeckChoiceModalDouble(
        specs,
        {
          maxLoad: currentMaxLoad,
          clearance: lowerFrontClearance,
          length: lowerDeckTotalLength,
          fits: false,
          weightLeft: currentMaxLoad - specs.weight,
          remainingLength: lowerRemainingLength
        },
        {
          height: upperDeckHeight,
          length: upperDeckTotalLength,
          fits: false,
          weightLeft: currentMaxLoad - specs.weight,
          remainingLength: upperRemainingLength
        },
        () => {}
      );
      return;
    }
    const handleLoadToDeck = (deck) => {
      const usedLengthKey =
        deck === "upper"
          ? `combo${activeCombo}_usedLength_upper`
          : `combo${activeCombo}_usedLength_lower`;
      const previousUsedLength = parseFloat(localStorage.getItem(usedLengthKey)) || 0;
      const newUsedLength = previousUsedLength + specs.length;
      localStorage.setItem(usedLengthKey, newUsedLength);
      const remainingAfterThisLoad = currentMaxLoad - specs.weight;
      localStorage.setItem(`combo${activeCombo}_remainingLoad`, remainingAfterThisLoad);
      document.getElementById("maxLoad").textContent = remainingAfterThisLoad.toLocaleString();

      const list = document.getElementById("loadedVehicleList");
      const li = document.createElement("li");
      li.textContent = `${year} ${make} ${model} ${trim} loaded on ${deck}`;
      const removeBtn = document.createElement("button");
      removeBtn.textContent = "Remove";
      removeBtn.className = "remove-btn";
      removeBtn.style.marginLeft = "10px";

     // removeBtn.onclick = () => {
        removeBtn.onclick = function() {
  // 1. Remove from UI
  li.remove();

  // 2. Get saved vehicles list
  let loadedVehicles = JSON.parse(localStorage.getItem(`combo${activeCombo}_loadedVehicles`) || "[]");

  // 3. Find this vehicle entry (by label & deck)
  const idx = loadedVehicles.findIndex(
    v => v.label === li.textContent && v.deck === deck
  );
  if (idx === -1) return; // not found, shouldn't happen

  const removed = loadedVehicles[idx];

  // 4. Remove from the loadedVehicles array
  loadedVehicles.splice(idx, 1);
  localStorage.setItem(`combo${activeCombo}_loadedVehicles`, JSON.stringify(loadedVehicles));

  // 5. Subtract vehicle's length from the *correct* usedLength (upper/lower)
  const deckUsedLengthKey =
    deck === "upper"
      ? `combo${activeCombo}_usedLength_upper`
      : `combo${activeCombo}_usedLength_lower`;

  let prevUsed = parseFloat(localStorage.getItem(deckUsedLengthKey)) || 0;
  let newUsed = Math.max(0, prevUsed - (removed.length || 0));
  localStorage.setItem(deckUsedLengthKey, newUsed);

  // 6. Add vehicle's weight back to remaining load
  let prevLoad = parseFloat(localStorage.getItem(`combo${activeCombo}_remainingLoad`)) || 0;
  let newLoad = prevLoad + (removed.weight || 0);
  localStorage.setItem(`combo${activeCombo}_remainingLoad`, newLoad);

  // 7. Update UI display
  if (document.getElementById("maxLoad")) {
    document.getElementById("maxLoad").textContent = newLoad.toLocaleString();
  }
  // Optionally update a deck-length-left display here if you have one.
};

      li.appendChild(removeBtn);
      list.appendChild(li);

      const saved = JSON.parse(localStorage.getItem(`combo${activeCombo}_loadedVehicles`) || "[]");
      saved.push({ label: li.textContent, weight: specs.weight, length: specs.length, deck });
      localStorage.setItem(`combo${activeCombo}_loadedVehicles`, JSON.stringify(saved));
    };


    // New logic: always show the modal if at least one deck "could" be loaded
if (true) { // always show the modal for double deck
  showDeckChoiceModalDouble(
    specs,
    {
      maxLoad: currentMaxLoad,
      clearance: lowerFrontClearance,
      length: lowerDeckTotalLength,
      fits: lowerFits,
      weightLeft: currentMaxLoad - specs.weight,
      remainingLength: lowerRemainingLength
    },
    {
      height: upperDeckHeight,
      length: upperDeckTotalLength,
      fits: upperFits,
      weightLeft: currentMaxLoad - specs.weight,
      remainingLength: upperRemainingLength
    },
    function (selectedDeck) {
      // Only handle if selected deck actually fits!
      if ((selectedDeck === "lower" && lowerFits) || (selectedDeck === "upper" && upperFits)) {
        handleLoadToDeck(selectedDeck);
      }
      // If user clicks Cancel or tries to load a full deck, do nothing
    }
  );
  return;
}

  }
  if (trailerType === "single") {
    const frontOverhang = parseFloat(localStorage.getItem(comboPrefix + "frontOverhang") || "0");
    const trailerLength = parseFloat(localStorage.getItem(comboPrefix + "trailerLength") || "0");
    const rearOverhang = parseFloat(localStorage.getItem(comboPrefix + "rearOverhang") || "0");
    const deckLengthLimit = (frontOverhang + trailerLength + rearOverhang) * 12;
    const deckHeight = parseFloat(localStorage.getItem(comboPrefix + "front-clearance")) || 0;
    const usedLengthKey = `combo${activeCombo}_usedLength`;
    const previousUsedLength = parseFloat(localStorage.getItem(usedLengthKey)) || 0;
    const remainingDeckLength = deckLengthLimit - previousUsedLength;
    const fitsLength = specs.length <= remainingDeckLength;
    const fitsHeight = (specs.height + deckHeight) <= 168;
    const fitsWeight = specs.weight <= currentMaxLoad;
    const fits = fitsLength && fitsHeight && fitsWeight;
    const reasons = [];
    if (!fitsLength) reasons.push("Too long for remaining deck space");
    if (!fitsHeight) reasons.push("Too tall (vehicle + deck exceeds 14 ft)");
    if (!fitsWeight) reasons.push("Too heavy");


    showSingleDeckModal(
  specs,
  {
    maxLoad: currentMaxLoad,
    deckHeight,
    remainingLength: remainingDeckLength
  },
  fits,
  reasons,
  currentMaxLoad - specs.weight,
  () => {
    const newUsedLength = previousUsedLength + specs.length;
    localStorage.setItem(usedLengthKey, newUsedLength);
    const remainingAfterThisLoad = currentMaxLoad - specs.weight;
    localStorage.setItem(
      `combo${activeCombo}_remainingLoad`,
      remainingAfterThisLoad
    );
    document.getElementById("maxLoad").textContent =
      remainingAfterThisLoad.toLocaleString();

    // FIXED: Define removeBtn and li
    const list = document.getElementById("loadedVehicleList");
    const li = document.createElement("li");
    li.textContent = `${year} ${make} ${model} ${trim} loaded on single`;

    const removeBtn = document.createElement("button");
    removeBtn.textContent = "Remove";
    removeBtn.className = "remove-btn";
    removeBtn.style.marginLeft = "10px";

    removeBtn.onclick = function() {
      li.remove();
      let loadedVehicles = JSON.parse(localStorage.getItem(`combo${activeCombo}_loadedVehicles`) || "[]");
      const idx = loadedVehicles.findIndex(v => v.label === li.textContent);
      if (idx === -1) return;
      const removed = loadedVehicles[idx];
      loadedVehicles.splice(idx, 1);
      localStorage.setItem(`combo${activeCombo}_loadedVehicles`, JSON.stringify(loadedVehicles));
      let prevUsed = parseFloat(localStorage.getItem(usedLengthKey)) || 0;
      let newUsed = Math.max(0, prevUsed - (removed.length || 0));
      localStorage.setItem(usedLengthKey, newUsed);
      let prevLoad = parseFloat(localStorage.getItem(`combo${activeCombo}_remainingLoad`)) || 0;
      let newLoad = prevLoad + (removed.weight || 0);
      localStorage.setItem(`combo${activeCombo}_remainingLoad`, newLoad);
      if (document.getElementById("maxLoad")) {
        document.getElementById("maxLoad").textContent = newLoad.toLocaleString();
      }
    };

        li.appendChild(removeBtn);
    list.appendChild(li);
    // Save to localStorage
    const saved = JSON.parse(
      localStorage.getItem(`combo${activeCombo}_loadedVehicles`) || "[]"
    );
    saved.push({ label: li.textContent, weight: specs.weight, length: specs.length });
    localStorage.setItem(
      `combo${activeCombo}_loadedVehicles`,
      JSON.stringify(saved)
    );
  }
);
    }
});

document.getElementById("upgradeSubscriptionBtn")?.addEventListener("click", function() {
  // Replace with your actual upgrade/subscription page
  window.location.href = "subscription.html";
});

// This ensures buttons are generated as soon as the page loads

function renderComboButtons() {
  const plan = localStorage.getItem("userPlan") || "starter";
  const maxCombos = plan === "starter" ? 1 : plan === "pro" ? 3 : 5;
  const container = document.getElementById("comboButtonsContainer");
  container.innerHTML = "";
  for (let i = 1; i <= maxCombos; i++) {
    const btn = document.createElement("button");
    btn.textContent = `Power Unit ${i}`;
    btn.className = "combo-btn";
    if (i === 1) btn.classList.add("active");
    btn.onclick = () => showCombo(i);
    container.appendChild(btn);
  }


  // Optional: Select the first combo by default if none active
  let activeCombo = parseInt(localStorage.getItem("activeCombo"), 10);
  if (!activeCombo || activeCombo > maxCombos) {
    activeCombo = 1;
    localStorage.setItem("activeCombo", "1");
  }
  
  showCombo(activeCombo);
}

  document.addEventListener("DOMContentLoaded", function() {
  renderComboButtons();
  updateComboVisibility();

function updateComboVisibility() {
  const plan = localStorage.getItem("userPlan") || "starter";
  const maxCombos = plan === "starter" ? 1 : plan === "pro" ? 3 : 5;

  for (let i = 1; i <= 5; i++) {
    const comboSection = document.getElementById("combo" + i);
    const saveBtn = document.getElementById("saveButton" + i);
    if (comboSection) comboSection.style.display = (i <= maxCombos) ? "" : "none";
    if (saveBtn) saveBtn.style.display = (i <= maxCombos) ? "inline-block" : "none";
  }
}

});

</script>
</body>
</html>